<tool id="csvtk-join" name="csvtk-join" version="0.1.0">
    <description>tables by column</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[

    ## Set the fields to join column(s) on. Must be separated by a " ; " ##
    #######################################################################
    #set $split_on = str($column_text.in_text).replace(",", ";")


    ###################
    ## Start Command ##
    ###################
    csvtk join 

        ## Set Tabular input/output flag if first input is tabular ##
        #############################################################
        #if $in_1[0].is_of_type("tabular"):
            -t -T
        #end if

        ## ignore case and specify fields to join ##
        ############################################
        -i -F -f '$split_on' 

        ## Set input files ##
        #####################
        #for $file in $in_1:
            '$file'
        #end for
        
        ## Fill columns if wanted ##
        ############################
        #if $unmatched.wanted == 'yes':
            -k 
            --fill '$unmatched.fill_value'
        #end if
        
        ## To output ##
        ###############
        > joined
    

    ]]></command>
    <inputs>
        <param type="data" name="in_1" format="csv,tabular"
        multiple="true" optional="false"
        label="Specify TSV or CSV file inputs"
        help="Input as many tsv or csv files to join. HOWEVER, they must all be the **same file type** or the tool will fail/not give results!" />
        <conditional name="column_text" >
            <param type="select" name="select" label="Join inputs based on" >
                <option value="column">Column Numbers</option>
                <option value="string">Column Name</option>
            </param>
            <when value="column">
                <param type="data_column" name="in_text"
                        data_ref="in_1" format_source="in_1"
                        multiple="True" force_select="True"
                        label="Select column numbers"
                        help="Select columns that will be used to join the input datasets"/>
            </when>
            <when value="string">
                <param type="text" name="in_text"
                optional="false"
                label="Join on column name"
                help="Specify column name to join inputs on. Multiple names can be given if separated by a ';'. Ex. (id;gene)"/>
            </when>
        </conditional>
        <conditional name="unmatched" >
            <param type="select" name="wanted"
            label="Keep unmatched columns"
            help="Include unmatched columns in output results?"
            >
                <option value="no">No</option>
                <option value="yes">Yes</option>
            </param>
            <when value="yes">
                <param type="text" name="fill_value"
                default=""
                label="What to fill unmatched columns with"
                help="Specify value to fill into all of the columns with no data" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data format_source="in_1" name="joined" from_work_dir="joined" label="$in_1[0].name by column $column_text.in_text" />
    </outputs>
    <tests>
        <test>
            
        </test>
    </tests>
    <help><![CDATA[
        
        Who knows, not me!

    ]]></help>
    <expand macro="citations" />
</tool>